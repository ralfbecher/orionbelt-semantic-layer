# OrionBelt Load Balancer Configuration (europe-west1)
# Retrieved 2026-02-24
#
# Architecture:
#   Client → Forwarding Rule (35.187.174.102:80)
#        → HTTP Proxy (orionbelt-lb-target-proxy)
#        → URL Map (orionbelt-lb)
#            /ui, /ui/*  → orionbelt-ui-backend (Cloud Run: orionbelt-ui)
#            /*          → orionbelt-backend    (Cloud Run: orionbelt-semantic-layer)
#        → Cloud Armor WAF (default-security-policy-for-backend-service-orionbelt-backend)

# --- Forwarding Rule ---
forwardingRule:
  name: orionbelt-http
  IPAddress: 35.187.174.102
  IPProtocol: TCP
  portRange: 80-80
  loadBalancingScheme: EXTERNAL_MANAGED
  networkTier: PREMIUM
  target: orionbelt-lb-target-proxy

# --- Target HTTP Proxy ---
targetHttpProxy:
  name: orionbelt-lb-target-proxy
  urlMap: orionbelt-lb

# --- URL Map ---
urlMap:
  name: orionbelt-lb
  defaultService: orionbelt-backend
  hostRules:
    - hosts: ["*"]
      pathMatcher: orionbelt-routes
  pathMatchers:
    - name: orionbelt-routes
      defaultService: orionbelt-backend
      pathRules:
        - paths: [/ui, /ui/*]
          service: orionbelt-ui-backend

# --- Backend Services ---
backendServices:
  - name: orionbelt-backend
    protocol: HTTPS
    neg: orionbelt-neg
    sessionAffinity: NONE
    timeoutSec: 30
    securityPolicy: default-security-policy-for-backend-service-orionbelt-backend

  - name: orionbelt-ui-backend
    protocol: HTTP
    neg: orionbelt-ui-neg
    sessionAffinity: GENERATED_COOKIE
    timeoutSec: 30
    securityPolicy: default-security-policy-for-backend-service-orionbelt-backend
